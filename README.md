# Хэш-таблица: исследование различных хэш-функций и возможностей оптимизации.

## Описание работы

В первой части в учебных целях исследуются различные (в основном простейшие и неприменимые на практике) хэш-функции. 

Элементами хэш-таблицы являются пары "ключ-значение": ключом являются слово, состоящее из букв латинского алфавита или цифр, значением - количество раз, которое данное слово встретилось во входных данных. В качестве входных данных должен быть использован текстовый файл, в котором каждое слово находится на отдельной строке, без пробелов. Программа для каждой хэш-функции по очереди помещает слова из входных данных в хэш-таблицу, а затем создает в указанной папке файл с именем хэш-функции и записывает в него полученное распределение (длина цепочки в каждой ячейке хэш-таблицы).

Вторая часть работы - оптимизация функции поиска в хэш-таблице - сделана в следующих коммитах.

## Подготовка входного файла

Для того чтобы превратить файл с неким текстом (например, `texts/miserables_vol1.txt`) во входной файл программы нужного формата, можно использовать скрипт на Python, запускаемый следующей командой из основной директории: 
```
python3 py_scripts/parse.py *входной файл* *имя выходного файла*
```

Пример:
```
python3 py_scripts/parse.py texts/miserables_vol1.txt texts/input.txt
```

Чтобы посчитать количество уникальных слов в файле (это может быть нужно для оценки размера хэш-таблицы), можно использовать другой скрипт, входным файлом для которого должен быть уже подготовленный файл (каждое слово на своей строке):
```
python3 py_scripts/uni_words.py *входной файл*
```

Пример:
```
python3 py_scripts/uni_words.py texts/input.txt
```


## Тестирование хэш-функций
1. Используйте команду `make`, чтобы скомпилировать программу.
2. В программе используются следующие аргументы командной строки:
    1. `-i` : входной файл
    2. `-o` : имя директории, в которой будет созданы файлы с результатами тестирования.
    3. `-s` : количество ячеек в хэш-таблице.
3. Запустите программу с нужными аргументами или самостоятельно, или с помощью команды `make run`. Пример: 
```
make run ARGS="-i texts/input.txt -o out -s 10271"
```

## Анализ результатов тестирования хэш-функций
Чтобы построить гистограмму распределения одной из хэш-функций, используйте скрипт:
```
python3 py_scripts/draw_hist.py *файл с результатами теста*
```

Пример:
```
python3 py_scripts/draw_hist.py out/hash_checksum
```

При запуске скрипта откроется интерактивное окно matplotlib. В заголовке гистограммы написаны название предоставленного файла и дисперсия (variance) данного распределения. Чем меньше значение дисперсии, тем равномернее распределение и выше скорость поиска в таблице (за счёт уменьшения средней длины цепочки).

### Полученные гистограммы:
- Входной файл для тестирования: `texts/input.txt`, полученный из `texts/miserables_vol1.txt`. 
- Размер хэш-таблицы: 10271 (простое число)

Код хэш-функций можно посмотреть в /src/hashfuncs.cpp.

![](/imgs/hash_const.png)
Функция возвращает всегда константное значение (19). Результат - единственная цепочка длиной в количество уникальных слов. Польза функции в том, что можно устроить проверку зрения (сможете увидеть столбик на гистограмме?)

![](/imgs/hash_first_letter_ascii.png)
Функция возвращает ascii-код первой буквы слова. Ожидаемо очень малый диапазон значений.

![](/imgs/hash_word_len.png)
Функция возвращает длину слова. Ожидаемо очень малый диапазон значений.

![](/imgs/hash_checksum.png)
Функция считает сумму ascii-кодов всех букв слова. Диапазон значений уже хотя бы достаточно широкий, чтобы он был виден на гистограмме, но все ещё довольно мал. Кроме того, внутри диапазона нет равномерности распределения.

![](/imgs/hash_rol_xor.png)
Функция итеративно использует ROL (битовый поворот влево) и XOR (исключающее или). Охвачен почти весь диапазон значений, дисперсия приблизилась к единице.

![](/imgs/hash_ror_xor.png)
Функция итеративно использует ROR (битовый поворот вправо) и XOR (исключающее или). **Результат отличается от предыдущей функции, несмотря на кажущееся малое различие, состоящее только в замене ROL на ROR. Охвачен меньший диапазон значений (больше пробелов), дисперсия около 5.** 

![](/imgs/hash_murmur3.png)
Используется известная хэш-функция murmur3. Дисперсия практически равна единице, визуально наблюдается равномерное распределение, а максимальный load factor равен 6.